<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Software adventures and thoughts</title>
    <generator uri="https://hugo.spf13.com">Hugo</generator>
    <link>http://blog.ralch.com/tags/opinion/index.xml</link>
    <language>en-us</language>
    <author>Svett Ralchev</author>
    
    <updated>Mon, 01 Jan 0001 00:00:00 UTC</updated>
    
    <item>
      <title>Design Patterns in Golang: The Good, the Bad and the Ugly</title>
      <link>http://blog.ralch.com/tutorial/design-patterns/golang-design-patterns/</link>
      <pubDate>Wed, 03 Feb 2016 13:34:23 UTC</pubDate>
      <author>Svett Ralchev</author>
      <guid>http://blog.ralch.com/tutorial/design-patterns/golang-design-patterns/</guid>
      <description>

&lt;p&gt;Recently I started a series of articles about &lt;a href=&#34;https://en.wikipedia.org/wiki/Design_Patterns&#34;&gt;Gang of Four Design
Patterns&lt;/a&gt; and their adoption in
Golang. They made a lot of noise in the community. I read a lot
of contradictionary opionions whether should be used or not. I am publishing those
articles as show case how the common design patterns can be adopted and implemented
in Golang. I don&amp;rsquo;t encourage or promote their usage. Every developer has own style
of programming, architecture desing and problem solving solutions.&lt;/p&gt;

&lt;p&gt;Well, I don&amp;rsquo;t have a strong opionion about that. However, I have my own angle
of view about this topic. I have never been a strong believer that they should
be used intensively in any project. For me they have always been a language for
communication among development teams. Yes, they solve particular problems. But
I don&amp;rsquo;t think we should use them, because they exist and ar good practice.&lt;/p&gt;

&lt;p&gt;Particular pattern should be used only in concrete case, when we gain benefit of
that. I don&amp;rsquo;t encourage applying it by the book.&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;Design Patterns&lt;/code&gt; have never been something encourage by the Golang community.
They are not idiomatic for the language. Everybody knows that the language itself
is very opioninated and idiomatic. There are no so many ways to achieve particular
task or solve particular problem.&lt;/p&gt;

&lt;p&gt;But let&amp;rsquo;s explore. Are they used in the existing Golang packages? I will give
you a few examples how they are used in Golang libraries:&lt;/p&gt;

&lt;h4 id=&#34;singleton-design-pattern&#34;&gt;Singleton Design Pattern&lt;/h4&gt;

&lt;p&gt;The &lt;a href=&#34;https://golang.org/pkg/net/http/&#34;&gt;net/http&lt;/a&gt; package has
&lt;a href=&#34;https://golang.org/src/net/http/client.go?s=76:76#L76&#34;&gt;http.DefaultClient&lt;/a&gt; and
&lt;a href=&#34;https://golang.org/src/net/http/server.go?s=1595:1595#L1595&#34;&gt;http.DefaultServeMux&lt;/a&gt;
objects that are alive during the application lifecycle. The &lt;code&gt;DefaultClient&lt;/code&gt; is
used by &lt;a href=&#34;https://golang.org/src/net/http/client.go?s=9198:9246#L270&#34;&gt;Get&lt;/a&gt;,
&lt;a href=&#34;https://golang.org/src/net/http/client.go?s=15901:15950#L500&#34;&gt;Head&lt;/a&gt; and
&lt;a href=&#34;https://golang.org/src/net/http/client.go?s=13816:13898#L443&#34;&gt;Post&lt;/a&gt; functions
to send request to http server.&lt;/p&gt;

&lt;p&gt;Those variables contains a single instances that can be used accros the application.
The implementation does not follow the same as most of the mainstream language. It&amp;rsquo;s
still Golang idiomatic.&lt;/p&gt;

&lt;h4 id=&#34;factory-design-pattern&#34;&gt;Factory Design Pattern&lt;/h4&gt;

&lt;p&gt;Did you used &lt;a href=&#34;https://github.com/lib/pq&#34;&gt;PostrgreSQL&lt;/a&gt; library like that?&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Golang&#34;&gt;import (
	&amp;quot;database/sql&amp;quot;
	_ &amp;quot;github.com/lib/pq&amp;quot;
)

func main() {
	db, err := sql.Open(&amp;quot;postgres&amp;quot;, &amp;quot;user=pqgotest dbname=pqgotest sslmode=verify-full&amp;quot;)
	if err != nil {
		log.Fatal(err)
	}

	age := 21
	rows, err := db.Query(&amp;quot;SELECT name FROM users WHERE age = $1&amp;quot;, age)
	...
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Well in order to connect to &lt;code&gt;PostgreSQL&lt;/code&gt; server the &lt;code&gt;sql&lt;/code&gt; package instaciate the
registered driver via &lt;code&gt;Factory&lt;/code&gt; Design Pattern. The driver is registered by
&lt;a href=&#34;https://golang.org/src/database/sql/sql.go?s=805:853#L24&#34;&gt;this function&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;Factory&lt;/code&gt; function is &lt;a href=&#34;https://golang.org/src/database/sql/sql.go?s=805:853#L468&#34;&gt;db.Open&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&#34;iterator-design-pattern&#34;&gt;Iterator Design Pattern&lt;/h4&gt;

&lt;p&gt;Golang has a &lt;a href=&#34;https://golang.org/pkg/go/token/&#34;&gt;token package&lt;/a&gt; that defines
constants representing the lexical tokens of the Go programming language and
basic operations on tokens (printing, predicates).&lt;/p&gt;

&lt;p&gt;The package has a
&lt;a href=&#34;https://golang.org/src/go/token/position.go?s=9878:10118#L312&#34;&gt;token.FileSet&lt;/a&gt;
struct that represents a set of source files. The struct implements &lt;a href=&#34;https://en.wikipedia.org/wiki/Iterator_pattern&#34;&gt;The
Interator Design Pattern&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Golang&#34;&gt;func printStats(d time.Duration) {
 	fileCount := 0
 	lineCount := 0
 	fset.Iterate(func(f *token.File) bool {
 		fileCount++
 		lineCount += f.LineCount()
 		return true
 	})
 	fmt.Printf(
 		&amp;quot;%s (%d files, %d lines, %d lines/s)\n&amp;quot;,
 		d, fileCount, lineCount, int64(float64(lineCount)/d.Seconds()),
 	)
 }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;It has an
&lt;a href=&#34;https://golang.org/src/go/token/position.go?s=11886:11931#L378&#34;&gt;Iterate&lt;/a&gt;
function that calls a function for the files in the file set in the order they
were added until it returns false.&lt;/p&gt;

&lt;h4 id=&#34;builder-or-strategy-design-pattern&#34;&gt;Builder or Strategy Design Pattern&lt;/h4&gt;

&lt;p&gt;The Golang has an &lt;a href=&#34;https://golang.org/pkg/image/&#34;&gt;image&lt;/a&gt; package that can
generate and manipulate different formats of images. The package exposes
interfaces &lt;a href=&#34;https://golang.org/pkg/image/#Image&#34;&gt;image.Image&lt;/a&gt; and
subpackage &lt;a href=&#34;https://golang.org/pkg/image/draw/&#34;&gt;draw&lt;/a&gt; that has
&lt;a href=&#34;https://golang.org/pkg/image/draw/#Drawer&#34;&gt;draw.Drawer&lt;/a&gt; interface.&lt;/p&gt;

&lt;p&gt;These interfaces allow composition of different shapes and draw strategies:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Golang&#34;&gt;// Example from: http://blog.golang.org/go-imagedraw-package
type circle struct {
    p image.Point
    r int
}

func (c *circle) ColorModel() color.Model {
    return color.AlphaModel
}

func (c *circle) Bounds() image.Rectangle {
    return image.Rect(c.p.X-c.r, c.p.Y-c.r, c.p.X+c.r, c.p.Y+c.r)
}

func (c *circle) At(x, y int) color.Color {
    xx, yy, rr := float64(x-c.p.X)+0.5, float64(y-c.p.Y)+0.5, float64(c.r)
    if xx*xx+yy*yy &amp;lt; rr*rr {
        return color.Alpha{255}
    }
    return color.Alpha{0}
}

draw.DrawMask(dst, dst.Bounds(), src, image.ZP, &amp;amp;circle{p, r}, image.ZP, draw.Over)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;For me it looks more like &lt;a href=&#34;http://blog.ralch.com/tutorial/design-patterns/golang-builder/&#34;&gt;Builder Design
Pattern&lt;/a&gt; or
&lt;a href=&#34;https://en.wikipedia.org/wiki/Strategy_pattern&#34;&gt;Strategy Design Pattern&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;You can read more about it in this &lt;a href=&#34;http://blog.golang.org/go-imagedraw-package&#34;&gt;Golang blog
post&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;PS. Please share your finding regarding any other examples of GoF Desing
Pattern usage. I will be glad to publish them as well.&lt;/em&gt;&lt;/p&gt;

&lt;h4 id=&#34;verdict&#34;&gt;Verdict&lt;/h4&gt;

&lt;p&gt;The Desing Patterns do exist in Golang. Their implementation does not align with
the one that we have used to see in the mainstream languages like C#, JAVA and etc.&lt;/p&gt;

&lt;p&gt;But what should we consider as idiomatic for Golang?&lt;/p&gt;

&lt;p&gt;&lt;em&gt;As my colleague George said:&lt;/em&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;After all we (as users) define the idioms in the language.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;It&amp;rsquo;s true, isn&amp;rsquo;t it?&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
